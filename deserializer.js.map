{"version":3,"sources":["deserializer.es6"],"names":[],"mappings":"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","file":"deserializer.js","sourcesContent":["'use strict';\r\nimport _ from 'lodash';\r\n\r\nexport default class Deserializer {\r\n  static Symbols = {PostProcess: Symbol()};\r\n\r\n  data = null;\r\n  instances = null;\r\n  objectsToPostProcess = [];\r\n\r\n  constructor(jsonc) {\r\n    this.jsonc = jsonc;\r\n  }\r\n\r\n  deserialize(data) {\r\n    this.data = data;\r\n    this.instances = this._map(this.data.instances, this._instantiateValue);\r\n\r\n    _.forEach(this.instances, this._restoreProperties, this);\r\n    this._restoreProperties(this.data.root);\r\n    _.forEach(this.objectsToPostProcess, this._postProcess, this);\r\n\r\n    return this.data.root;\r\n  }\r\n\r\n  _map(obj, fn) {\r\n    if (obj instanceof Array)\r\n      return _.map(obj, fn, this);\r\n    else\r\n      return _.mapValues(obj, fn, this);\r\n  }\r\n\r\n  _instantiateValue(value) {\r\n    const isRegisteredType = (obj) => '__type__' in obj && obj.__type__ && this.jsonc.hasTypeName(obj.__type__);\r\n    const isNativeType = (obj) => '__type__' in obj && (obj.__type__ === '__object__' || obj.__type__ === '__array__');\r\n\r\n    const typeCategory = this._getTypeCategory(value);\r\n    if (typeCategory === 'function')\r\n      return undefined;\r\n\r\n    if (typeCategory === 'primitive')\r\n      return value;\r\n\r\n    if (isRegisteredType(value))\r\n      return instantiateRegisteredType.call(this, value);\r\n\r\n    if (isNativeType(value))\r\n      return instantiateNativeType.call(this, value);\r\n\r\n    return value;\r\n\r\n\r\n    function instantiateRegisteredType(obj) {\r\n      var instance = new this.jsonc.registry[obj.__type__]();\r\n      if (instance[Deserializer.Symbols.PostProcess])\r\n        this.objectsToPostProcess.push(instance);\r\n      return _.assign(instance, obj.__value__);\r\n    }\r\n\r\n    function instantiateNativeType(obj) {\r\n      var instance = obj.__type__ === '__object__'\r\n        ? {}\r\n        : [];\r\n      return _.assign(instance, obj.__value__);\r\n    }\r\n  }\r\n\r\n  _getTypeCategory(value) {\r\n    const type = typeof value;\r\n    if (type === 'function' || (value !== null && type === 'object'))\r\n      return type;\r\n    return 'primitive';\r\n  }\r\n\r\n  _restoreProperties(obj) {\r\n    const typeCategory = this._getTypeCategory(obj);\r\n    if (typeCategory !== 'object')\r\n      return;\r\n\r\n    _.forOwn(obj, this._restoreProperty, this);\r\n  }\r\n\r\n  _restoreProperty(value, key, obj) {\r\n    const isReference = (obj) => '__index__' in obj;\r\n    const typeCategory = this._getTypeCategory(value);\r\n    if (typeCategory !== 'object')\r\n      return;\r\n\r\n    if (isReference(value))\r\n      obj[key] = this.instances[value.__index__];\r\n  }\r\n\r\n  _postProcess(obj) {\r\n    obj[Deserializer.Symbols.PostProcess]();\r\n  }\r\n}\r\n"]}